on("chat:message", function(msg){
   
  if( msg.type == "api" && msg.content.indexOf("!ê¸°ë„") !== -1 ){
    
     var cutie = findObjs({type: 'character', name: msg.who})[0],
         cutieIs = cutie.get('name'),
         cutieId = cutie.get('id'),
         guilt = findObjs({type: 'attribute', name: 'ì£„ì±…ê°', characterid: cutie.id})[0],
         guiltIs = parseInt(guilt.get('current')),
         faith = findObjs({type: 'attribute', name: 'ì‹ ì•™ì‹¬', characterid: cutie.id})[0],
         faithIs = parseInt(faith.get('current')),
         guiltFinal = guiltIs;
         
    sendChat( cutieIs, "/r d6<@{"+ msg.who + "|ì‹ ì•™ì‹¬}", function(rslt){
        
        var prayResult = JSON.parse(rslt[0].content),
            theResult = parseInt(prayResult.rolls[0].results[0].v);
        
        sendChat( "", "/desc ğŸ’’ " + cutieIs + "ì€(ëŠ”) ê¸°ë„ë¥¼ í•©ë‹ˆë‹¤... ğŸ’’");
        
        if( prayResult.total == 1 ){
            
            guiltFinal = guiltIs - ( faithIs * 10 );
            
            if ( guiltFinal < 1 ){
                
                guiltFinal = 1;
                
            }
            
            guilt.set('current', guiltFinal);
            
            sendChat( "character|" + cutieId, "/em ì˜ ì‹ ì•™ì‹¬ì€ [[" + faithIs + "]], ì£¼ì‚¬ìœ„ì˜ ê²°ê³¼ëŠ” [[" + theResult + "]].\n/em ì€(ëŠ”) ì‹ ê»˜ì„œ ìš©ì„œí•´ ì£¼ì‹  ê²ƒë§Œ ê°™ì€ ê¸°ë¶„ì„ ëŠë‚ë‹ˆë‹¤.\n/em ì˜ ì£„ì±…ê°ì´ [[" + guiltFinal + "]]ì´(ê°€) ë˜ì—ˆìŠµë‹ˆë‹¤.\n!ì£„ì±…ê°ë°”ë€œ");
            
        }
        else{
            
            guiltFinal = guiltIs + ( faithIs * 4 );
            
            if ( guiltFinal > 250 ){
                
                guiltFinal = 250;
                
            }
            
            guilt.set('current', guiltFinal);
            
            sendChat( "character|" + cutieId, "/em ì˜ ì‹ ì•™ì‹¬ì€ [[" + faithIs + "]], ì£¼ì‚¬ìœ„ì˜ ê²°ê³¼ëŠ” [[" + theResult + "]].\n/em ì€(ëŠ”) ê¸°ë„ì— ë§ˆìŒì„ ì§‘ì¤‘í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n/em ì˜ ì£„ì±…ê°ì´ [[" + guiltFinal + "]]ì´(ê°€) ë˜ì—ˆìŠµë‹ˆë‹¤.\n!ì£„ì±…ê°ë°”ë€œ");
            
        }
        
    });
    
  }
  
  if( msg.type == "api" && msg.content.indexOf("!ê³ í•´ì„±ì‚¬") !== -1 ){
    
     var cutie = findObjs({type: 'character', name: msg.who})[0],
         cutieIs = cutie.get('name'),
         cutieId = cutie.get('id'),
         guilt = findObjs({type: 'attribute', name: 'ì£„ì±…ê°', characterid: cutie.id})[0],
         guiltIs = parseInt(guilt.get('current')),
         faith = findObjs({type: 'attribute', name: 'ì‹ ì•™ì‹¬', characterid: cutie.id})[0],
         faithIs = parseInt(faith.get('current')),
         guiltFinal = guiltIs;
         
    sendChat( cutieIs, "/r d6<@{"+ msg.who + "|ì‹ ì•™ì‹¬}", function(rslt){
        
        var confessResult = JSON.parse(rslt[0].content),
            theResult = parseInt(confessResult.rolls[0].results[0].v);
        
        sendChat( "", "/desc ğŸ’’ " + cutieIs + "ì€(ëŠ”) ê³ í•´ì„±ì‚¬ë¥¼ í•©ë‹ˆë‹¤... ğŸ’’");
        
        if( confessResult.total == 1 ){
            
            guiltFinal = guiltIs - ( faithIs * 20 );
            
            if ( guiltFinal < 1 ){
                
                guiltFinal = 1;
                
            }
            
            guilt.set('current', guiltFinal);
            
            sendChat( "character|" + cutieId, "/em ì˜ ì‹ ì•™ì‹¬ì€ [[" + faithIs + "]], ì£¼ì‚¬ìœ„ì˜ ê²°ê³¼ëŠ” [[" + theResult + "]].\n/em ì€(ëŠ”) ì‹ ë¶€ë‹˜ì˜ ë§ì”€ì„ ë“£ê³  í•œê²° ë§ˆìŒì´ ê°€ë²¼ì›Œì¡ŒìŠµë‹ˆë‹¤.\n/em ì˜ ì£„ì±…ê°ì´ [[" + guiltFinal + "]]ì´(ê°€) ë˜ì—ˆìŠµë‹ˆë‹¤.\n!ì£„ì±…ê°ë°”ë€œ");
            
        }
        else{
            
            guiltFinal = guiltIs + ( faithIs * 10 );
            
            if ( guiltFinal > 250 ){
                
                guiltFinal = 250;
                
            }
            
            guilt.set('current', guiltFinal);
            
            sendChat( "character|" + cutieId, "/em ì˜ ì‹ ì•™ì‹¬ì€ [[" + faithIs + "]], ì£¼ì‚¬ìœ„ì˜ ê²°ê³¼ëŠ” [[" + theResult + "]].\n/em ì€(ëŠ”) ì‹ ë¶€ë‹˜ì—ê²Œ ì‚¬ì‹¤ì„ í„¸ì–´ë†“ì•˜ë”ë‹ˆ ì˜¤íˆë ¤ ë” ë¶€ë„ëŸ½ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤.\n/em ì˜ ì£„ì±…ê°ì´ [[" + guiltFinal + "]]ì´(ê°€) ë˜ì—ˆìŠµë‹ˆë‹¤.\n!ì£„ì±…ê°ë°”ë€œ");
            
        }
        
    });
    
  }
  
});
